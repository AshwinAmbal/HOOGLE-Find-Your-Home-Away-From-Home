<HTML>

<head>
	<script type="text/javascript"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/solid.css" integrity="sha384-QokYePQSOwpBDuhlHOsX0ymF6R/vLk/UQVz3WHa6wygxI5oGTmDTv8wahFOSspdm" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/fontawesome.css" integrity="sha384-vd1e11sR28tEK9YANUtpIOdjGW14pS87bUBuOIoBILVWLFnS+MCX9T6MMf0VdPGq" crossorigin="anonymous">
	<link rel="stylesheet" href="index.css">
	<link rel="stylesheet" href="bar-update.css">
	<link rel="stylesheet" href="word-radar.css">
</head>

<body>
	<section class='section-title align-center'>
			<div class='blank'></div>
			<div class='website-title'>Website Title</div>
			<div class='website-sub'>secondary text</div>
			<div class="arrow bounce align-center" id='arrow'>
				<i class="fa fa-arrow-down fa-2x"></i>
			</div>
	</section>
	<section class='section-heatmap align-center'>
		<div id='heatmap_1'></div>
		<div id='heatmap_info_1'>
			Click any state to continue ...
		</div>
	</section>
	<section class='hide'>
		<div class="chart-container" id='bar-chart_2'>
			<div class='badge'>
				<div class='badge-common badge-warning' id='bar-chart-state'></div>
				<div class='badge-common badge-primary' id='bar-chart-year'></div>
				<div class='badge-common badge-secondary' id='bar-chart-month'></div>
			</div>
			<div class='chart-layout'>
				<div id='chart-info' class='chart-info'>
						<div class="chart-info__heading">Lorem, ipsum dolor.</div>
						<div class="chart-info__content">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta beatae quo iure totam, possimus repellendus enim provident alias animi obcaecati porro quam voluptatem ea, autem praesentium incidunt quos labore adipisci tenetur? Tempore eveniet atque ex ad molestias quasi aliquid inventore sit, iusto laudantium, aliquam quia rerum sequi reprehenderit ab veritatis.</div>
						<div class="chart-info__buttons">
								<i class="fas fa-step-backward" id='back'></i>
								<i class="fas fa-pause-circle" id='pause'></i>
								<i class="fas fa-step-forward" id='forward'></i>
						</div>
				</div>
				<div id="chart"></div>
			</div>
		</div>
	</section>
	<section class=' hide section-word'>
		<!-- Add the Radar and Word Cloud chart here -->
		<div class='hotel-selection' >
			<!-- hotel selection tab -->
		</div>
		<div class='hotel-charts'>
			<div class='word-cloud'>
				<!-- add the word cloud here -->
			</div>
			<div class='radar-chart'>
				<!-- add radar chart here -->
			</div>
		</div>
	</section>
	<script type="module">
	import drawChart from './bar-update.js'
	function scrollSmooth(top) {
		window.scrollTo({
			top,
			behavior: 'smooth',
			duration: 2000
		})
	}

	const arrow = document.querySelector('#arrow');
	arrow.addEventListener('click', () => {
		scrollSmooth(800)
	})

	function showBarChart() {
		const hiddenSection = document.querySelectorAll('section.hide')
		console.log(hiddenSection, hiddenSection.length)
		if (hiddenSection !== null) {
			hiddenSection.forEach(e =>  e.classList.toggle('hide'))
		}
	}
	(function createHeatMap(){
		var margin = { top: 20, right: 30, bottom: 60, left: 60 }
			, width = 1440 - margin.left - margin.right
			, height = 630 - margin.top - margin.bottom;
		// D3 Projection
		var projection = d3.geo.albersUsa()
			.translate([width / 2, height / 2])    // translate to center of screen
			.scale([1000]);          // scale things down so see entire US

		// Define path generator
		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
			.projection(projection);  // tell path generator to use albersUsa projection


		// Define linear scale for output
		var color = d3.scale.linear().range(["rgb(213,222,217)", "rgb(69,173,168)", "rgb(84,36,55)", "rgb(217,91,67)"]);

		var legendText = ["19-20", "20-21", "21-22", "22-23","23-24" ,"Other States"];

		var svg = d3.select("#heatmap_1")
			.append("svg")
			.attr("width", width)
			.attr("height", height);

		var div = d3.select("#heatmap_1")
			.append("div")
			.attr("class", "tooltip")
			.style("opacity", 0);



		// Load in my states data!
		d3.csv("stateslived1.csv", function (data) {
			color.domain([0, 1, 2, 3, 4, 5]); // setting the range of the input data

			// Load GeoJSON data and merge with states data
			d3.json("us-states.json", function (json) {

				// Loop through each state data value in the .csv file
				var legend = d3.select("#heatmap_1").append("svg")
					.attr("class", "legend")
					.attr("width", 400)
					.attr("height", 200)
					.selectAll("g")
					.data(color.domain().slice().reverse())
					.enter()
					.append("g")
					.attr("transform", function (d, i) { return "translate(200," + i * 20 + ")"; });

				legend.append("rect")
					.attr("width", 18)
					.attr("height", 18)
					.style("fill", color);

				legend.append("text")
					.data(legendText)
					.attr("x", 24)
					.attr("y", 9)
					.attr("dy", ".35em")
					.text(function (d) { return d; });

				for (var i = 0; i < data.length; i++) {

					// Grab State Name
					var dataState = data[i].state;

					// Grab data value
					var dataValue = data[i].visited;

					// Find the corresponding state inside the GeoJSON
					for (var j = 0; j < json.features.length; j++) {
						//var jsonState = json.features[j].properties.name;
						var jsonState = json.features[j].properties.NAME;

						if (dataState == jsonState) {

							// Copy the data value into the JSON
							json.features[j].properties.visited = dataValue;

							// Stop looking through the JSON
							//break;
						}
					}
				}

				// Bind the data to the SVG and create one path per GeoJSON feature
				svg.selectAll("path")
					.data(json.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("stroke", "#fff")
					.style("stroke-width", "1")
					.on("mouseover", function (d) {
						div.transition()
							.duration(200)
							.style("opacity", .9);
						div.text(d.properties.NAME)
							.style("left", (d3.event.pageX) + "px")
							.style("top", (d3.event.pageY - 28) + "px");
					})
					.on("click", d => {
						showBarChart()
						scrollSmooth(1580)
						drawChart(d.properties)
					})

					// fade out tooltip on mouse out
					.on("mouseout", function (d) {
						div.transition()
							.duration(500)
							.style("opacity", 0);
					})
					.style("fill", "rgb(213,222,217)")
					.transition()
					.duration(3000)
					.style("fill", function (d) {

						// Get data value
						var value = d.properties.visited;
						//console.log(value);

						// if (value)
						// {
						// //If value exists…
						// return color(value);
						// }
						if (value >= 19 && value < 20) {
							//If value exists…
							return "rgb(217,91,67)";
						}
						else if (value >= 20 && value < 21) {
							//If value exists…
							return "rgb(69,173,168)";
						}
						else if (value >= 21 && value < 22) {
							//If value exists…
							return "rgb(84,36,55)";
						} else if (value >= 22 && value < 23) {
							//If value exists…
							return "rgb(90,136,52)";
						}else if (value >= 23 && value < 24) {
							//If value exists…
							return "rgb(45,36,75)";
						}
						else {
							//If value is undefined…
							return "rgb(213,222,217)";
							//return "red";
						}
					})
			});

		});
	})()
	</script>
	<script src="bar-update.js"></script>
</body>

</html>